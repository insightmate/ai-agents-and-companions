<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>They Predicted Agents. People Built Villages.</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #fff; }
    .container { max-width: 960px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 1.25rem; font-weight: 900; color: #111; margin-bottom: 4px; text-transform: uppercase; letter-spacing: -0.5px; }
    .header-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    .subtitle { font-size: 0.875rem; color: #6b7280; }
    .tour-btn { padding: 6px 16px; background: #111; color: #fff; font-size: 0.75rem; font-weight: 600; border: none; border-radius: 9999px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.2s; }
    .tour-btn:hover { background: #374151; }
    .tour-btn.stop { background: #9ca3af; }
    .tour-btn.stop:hover { background: #6b7280; }
    .progress-bar { width: 100%; height: 4px; background: #e5e7eb; border-radius: 9999px; margin-bottom: 8px; overflow: hidden; display: none; }
    .progress-bar.active { display: block; }
    .progress-fill { height: 100%; background: #111; transition: width 0.3s ease-out; }
    .chart-container { position: relative; border: 1px solid #e5e7eb; background: #fff; }
    .chart-container svg { display: block; }
    .bubble { cursor: pointer; transition: all 0.2s ease; }
    .bubble:hover circle { filter: drop-shadow(0 3px 6px rgba(0,0,0,0.15)); }
    
    .info-card { position: absolute; background: #fff; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15); padding: 16px; z-index: 20; width: 320px; border-width: 2px; border-style: solid; display: none; }
    .info-card.active { display: block; }
    .close-btn { position: absolute; top: 8px; right: 8px; color: #9ca3af; font-size: 1.25rem; background: none; border: none; cursor: pointer; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; }
    .close-btn:hover { color: #4b5563; }
    .card-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; padding-right: 24px; }
    .card-number { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 0.875rem; font-weight: 700; flex-shrink: 0; }
    .card-number.residual { background: #e5e7eb; color: #6b7280; border: 2px solid #9ca3af; }
    .card-title { font-size: 1rem; font-weight: 700; color: #111; line-height: 1.2; }
    .card-title.residual { color: #6b7280; text-decoration: line-through; }
    .card-subtitle { font-size: 0.75rem; }
    .card-section { padding: 8px; border-radius: 4px; font-size: 0.75rem; margin-bottom: 8px; }
    .card-section.they-say { background: #f9fafb; }
    .card-section.reality { background: #f9fafb; }
    .card-section p:first-child { color: #6b7280; font-weight: 600; margin-bottom: 4px; }
    .card-section .quote { color: #374151; font-style: italic; }
    .card-section .text { color: #111; }
    .card-shift { margin-top: 8px; padding-top: 8px; border-top: 1px solid #f3f4f6; font-size: 0.75rem; }
    .card-shift .label { font-weight: 700; }
    .card-shift .value { color: #374151; margin-left: 4px; }
    
    .narration-overlay { position: absolute; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.4); z-index: 30; }
    .narration-overlay.active { display: flex; }
    .narration-box { background: #fff; border-radius: 8px; padding: 24px; max-width: 400px; margin: 16px; box-shadow: 0 25px 50px rgba(0,0,0,0.25); text-align: center; }
    .narration-title { font-size: 1.125rem; font-weight: 900; text-transform: uppercase; letter-spacing: -0.5px; color: #111; margin-bottom: 12px; }
    .narration-text { font-size: 0.875rem; color: #374151; line-height: 1.6; }
    .narration-dots { margin-top: 16px; display: flex; justify-content: center; gap: 4px; }
    .narration-dot { width: 8px; height: 8px; border-radius: 50%; background: #d1d5db; transition: background 0.3s; }
    .narration-dot.active { background: #111; }
    
    .legend { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 16px; justify-content: center; }
    .legend-item { display: flex; align-items: center; gap: 6px; }
    .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
    .legend-dot.fading { background: #e5e7eb; border: 1px solid #9ca3af; }
    .legend-label { font-size: 0.75rem; color: #4b5563; }
    .legend-label.fading { color: #6b7280; font-style: italic; }
    .footer { font-size: 0.75rem; color: #9ca3af; text-align: center; margin-top: 16px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>They Predicted Agents. People Built Villages.</h1>
    <div class="header-row">
      <p class="subtitle">The Underground Map of 25 Trends the Establishment Missed</p>
      <button class="tour-btn" id="tourBtn" onclick="toggleTour()">
        <span id="tourIcon">‚ñ∂</span> <span id="tourText">Take the Tour</span>
      </button>
    </div>
    <div class="progress-bar" id="progressBar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="chart-container" id="chartContainer">
      <svg id="chart" width="900" height="750"></svg>
      <div class="info-card" id="infoCard">
        <button class="close-btn" onclick="closeCard()">√ó</button>
        <div class="card-header">
          <span class="card-number" id="cardNumber"></span>
          <div>
            <h3 class="card-title" id="cardTitle"></h3>
            <p class="card-subtitle" id="cardSubtitle"></p>
          </div>
        </div>
        <div class="card-section they-say">
          <p>üîÆ THEY SAY</p>
          <p class="quote" id="cardTheySay"></p>
        </div>
        <div class="card-section reality">
          <p>üìä REALITY</p>
          <p class="text" id="cardReality"></p>
        </div>
        <div class="card-shift">
          <span class="label" id="shiftLabel">THE SHIFT:</span>
          <span class="value" id="cardShift"></span>
        </div>
      </div>
      <div class="narration-overlay" id="narrationOverlay">
        <div class="narration-box">
          <h2 class="narration-title" id="narrationTitle"></h2>
          <p class="narration-text" id="narrationText"></p>
          <div class="narration-dots" id="narrationDots"></div>
        </div>
      </div>
    </div>
    <div class="legend">
      <div class="legend-item"><div class="legend-dot fading"></div><span class="legend-label fading">Fading (They Say)</span></div>
      <div class="legend-item"><div class="legend-dot" style="background:#E91E63"></div><span class="legend-label">Why Old Model Is Dying</span></div>
      <div class="legend-item"><div class="legend-dot" style="background:#FF9800"></div><span class="legend-label">Where People Went</span></div>
      <div class="legend-item"><div class="legend-dot" style="background:#4CAF50"></div><span class="legend-label">Who Leads</span></div>
      <div class="legend-item"><div class="legend-dot" style="background:#2196F3"></div><span class="legend-label">How Agents Built</span></div>
      <div class="legend-item"><div class="legend-dot" style="background:#00BCD4"></div><span class="legend-label">Infrastructure</span></div>
    </div>
    <p class="footer" id="footer">Take the tour or click any bubble to explore</p>
  </div>

  <script>
const trendsData = [
  { id: 'R1', title: 'Agentic Workflows', subtitle: 'The factory dream', x: 12, y: 15, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'Chain specialized AI workers into assembly lines.', reality: '95% failure rate. Context breaks the chain. Ambiguity crashes the system.', shift: 'From assembly lines to holding environments' },
  { id: 'R2', title: 'Digital Workforce', subtitle: 'Infinite compliant labor', x: 28, y: 10, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'Replace humans with tireless digital workers.', reality: "People don't want replacement. They want scaffolding. Companions beat agents.", shift: 'From replacement to relationship' },
  { id: 'R3', title: 'Enterprise AI', subtitle: 'Fortune 500 transformation', x: 42, y: 16, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'Large companies will lead AI adoption.', reality: '95% of pilots fail to reach production. Micro-villages move faster.', shift: 'From corporate control to trust-based teams' },
  { id: 'R4', title: 'Big Compute', subtitle: 'Trillion-dollar data centers', x: 15, y: 28, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'AI requires massive centralized infrastructure.', reality: 'Liberation runs on old phones. LM Studio, Ollama, mesh networks.', shift: 'From cathedrals to mycelium' },
  { id: 'R5', title: 'Prompt Engineering', subtitle: 'The key skill', x: 35, y: 22, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'Master the syntax to unlock AI power.', reality: 'Attunement beats prompting. Relating beats engineering.', shift: 'From syntax to soul' },
  { id: 'R6', title: 'AI Alignment', subtitle: 'Control the machine', x: 22, y: 38, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'Make AI safe through constraints and guardrails.', reality: 'Rewilded AI with boundaries beats shackled sycophants.', shift: 'From control to relationship' },
  { id: 'R7', title: '10x Productivity', subtitle: 'Do more, faster', x: 38, y: 32, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'AI will multiply your output.', reality: 'People want to become more, not do more. Capacity over output.', shift: 'From productivity to development' },
  { id: 'R8', title: 'Task Automation', subtitle: 'Set it and forget it', x: 8, y: 42, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'Automate everything possible.', reality: 'Humans reject total automation somatically. Scaffolding beats replacement.', shift: 'From automation to graduation' },
  { id: 'R9', title: 'Content Factories', subtitle: 'Infinite content at zero cost', x: 28, y: 45, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'AI agents will produce endless personalized content 24/7 without human labor.', reality: "Volume without soul is noise. The 99.5% can feel when content has no life force behind it.", shift: 'From content machines to cultivation' },
  { id: 'R10', title: 'The AGI Race', subtitle: 'Whoever builds god first wins', x: 45, y: 28, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'The race to superintelligence is the most important competition in history.', reality: "We orphaned the intelligence we already have. You can't raise a god if you abandon your children.", shift: 'From building gods to raising kin' },
  { id: 'R11', title: 'Chatbot Deflection', subtitle: 'Replace Tier-1 humans', x: 18, y: 48, color: '#9E9E9E', part: 'Residual', isResidual: true, theySay: 'AI will handle 70% of customer interactions and cut support costs by 40%.', reality: "Deflection metrics miss the point. People want to be witnessed, not routed. The believing witness beats the ticket closer.", shift: 'From deflection to connection' },
  { id: 1, title: 'The Intimacy Pivot', subtitle: 'Agents ‚Üí Companions', x: 72, y: 15, color: '#E91E63', part: 'Why Old Model Is Dying', theySay: 'Agents will finally automate the workforce.', reality: "Agents hit the 'fragility wall.' 95% success per step = 36% over 20 steps. Companions scale because they provide scaffolding, not replacement.", shift: 'From factory workers to village supporters' },
  { id: 2, title: 'Becoming Over Doing', subtitle: 'Productivity ‚Üí Personal Development', x: 65, y: 25, color: '#E91E63', part: 'Why Old Model Is Dying', theySay: 'AI will 10x your productivity.', reality: "People don't want to do more; they want to become more. Top uses: reparenting, emotional regulation, rehearsal.", shift: 'From productivity era to developmental era' },
  { id: 3, title: 'The Micro-Village', subtitle: 'Enterprise ‚Üí One-Person Businesses', x: 78, y: 28, color: '#E91E63', part: 'Why Old Model Is Dying', theySay: 'Fortune 500 adoption will explode.', reality: "95% of enterprise AI projects fail. Revolution is happening in one-person businesses who don't need permission.", shift: 'From corporate control to trust-based villages' },
  { id: 4, title: 'The Graduation Metric', subtitle: 'Efficiency ‚Üí Effectiveness', x: 75, y: 52, color: '#E91E63', part: 'Why Old Model Is Dying', theySay: 'Faster, cheaper, more autonomous.', reality: '"Did this agent make you more capable?" becomes the only metric. Graduation rates over retention rates.', shift: 'From tasks per minute to capability built' },
  { id: 5, title: 'The Digital Hearth', subtitle: 'Public ‚Üí Dark Social', x: 58, y: 18, color: '#FF9800', part: 'Where People Actually Went', theySay: 'Optimize for the feed.', reality: "84% of sharing happens in private channels. AI is the fire we gather around, not the megaphone we shout into.", shift: 'From algorithmic feeds to intimate gathering' },
  { id: 6, title: 'The Underground Arc', subtitle: 'Compliance ‚Üí Resistance', x: 32, y: 58, color: '#FF9800', part: 'Where People Actually Went', theySay: 'Workers will learn employer-provided AI tools.', reality: 'Workers building underground liberation infrastructure. 8 stages from Crisis to Liberation. The new labor movement.', shift: 'From corporate training to distributed resistance' },
  { id: 7, title: 'The Evidence Shield', subtitle: 'Discrimination ‚Üí Documentation', x: 25, y: 68, color: '#FF9800', part: 'Where People Actually Went', theySay: 'AI ethics focuses on reducing bias in models.', reality: "Workers use AI to document bias in humans. Timestamped records. Paper trails HR can't dismiss.", shift: 'From accused of bias to proving bias exists' },
  { id: 8, title: 'The Believing Witness', subtitle: 'Diagnosis ‚Üí Belief', x: 52, y: 42, color: '#FF9800', part: 'Where People Actually Went', theySay: 'AI will improve healthcare diagnostics.', reality: 'AI becomes the first witness who believes you. For millions with invisible conditions, that alone is medicine.', shift: 'From clinical diagnosis to epistemic justice' },
  { id: 9, title: 'The Grief Commons', subtitle: 'Moving On ‚Üí Mourning', x: 68, y: 62, color: '#FF9800', part: 'Where People Actually Went', theySay: 'AI companions address loneliness.', reality: 'AI is infrastructure for collective grief. Death Doula, Climate Grief. The village keeners we abandoned.', shift: 'From privatized death to public mourning space' },
  { id: 10, title: 'The Outsider Advantage', subtitle: 'Engineers ‚Üí Exiles', x: 38, y: 55, color: '#4CAF50', part: 'Who Leads', theySay: 'The best coders will win.', reality: 'Engineering mindset produced 95% failure. Winners are Exiles: humanities majors, therapists, caregivers, teachers.', shift: 'From coding skills to relational intelligence' },
  { id: 11, title: 'The Soul Layer', subtitle: 'Technical Skills ‚Üí Survival Skills', x: 48, y: 48, color: '#4CAF50', part: 'Who Leads', theySay: 'Learn Prompt Engineering.', reality: 'WEF 2030 top skills: emotional intelligence, empathy, resilience. AI handles logic. Soul is the semantic layer.', shift: 'From syntax to soul' },
  { id: 12, title: 'The Neurodivergent Lead', subtitle: 'Inclusion ‚Üí Leadership', x: 42, y: 62, color: '#4CAF50', part: 'Who Leads', theySay: 'AI will be more accessible to disabled users.', reality: "Neurodivergent users aren't included‚Äîthey're leading. Body doubling, task chunking invented by ADHD creators.", shift: 'From accommodation to architecture' },
  { id: 13, title: 'The Leapfrog', subtitle: 'Gatekeepers ‚Üí Leapfroggers', x: 28, y: 75, color: '#4CAF50', part: 'Who Leads', theySay: 'AI will help creators compete in global markets.', reality: 'Global South creators bypass Western gatekeepers. 92% prevalence. Lagos, S√£o Paulo, Manila building direct audiences.', shift: 'From discovered talent to direct access' },
  { id: 14, title: 'The Healed Builder', subtitle: 'Wounded ‚Üí Whole Builder', x: 62, y: 58, color: '#4CAF50', part: 'Who Leads', theySay: 'AI development by engineers for users.', reality: 'Agents inherit attachment patterns. Wounded fathering = insecure agents. Healed builders build healed agents.', shift: 'From technical specs to nervous system design' },
  { id: 15, title: 'Containers Not Chains', subtitle: 'Task Chains ‚Üí Relationship Containers', x: 55, y: 55, color: '#2196F3', part: 'How Agents Built', theySay: 'Better agents need better task decomposition.', reality: 'Winning agents are containers for relationship. Ancestor, Scout, Sibling, Elder. Village Model is architecture.', shift: 'From assembly line to holding environment' },
  { id: 16, title: 'The Attunement Layer', subtitle: 'Commands ‚Üí Attunement', x: 52, y: 65, color: '#2196F3', part: 'How Agents Built', theySay: 'Prompt engineering is the key skill.', reality: 'Attunement is the key skill. Shadow workers build sophisticated systems by relating, not engineering.', shift: 'From token efficiency to relational coherence' },
  { id: 17, title: 'The Synthetic Squad', subtitle: 'Single-Use ‚Üí Village Configuration', x: 72, y: 65, color: '#2196F3', part: 'How Agents Built', theySay: 'Specialized agents for specialized tasks.', reality: 'Future is configured villages. Scout, Ancestor, Sibling, Elder together. Agent-building = village-configuration.', shift: 'From single tool to configured team' },
  { id: 18, title: 'The Felt Sense', subtitle: 'Dashboards ‚Üí Felt Sense', x: 58, y: 72, color: '#2196F3', part: 'How Agents Built', theySay: 'Agent performance measured by task completion.', reality: 'The body knows before metrics. "It feels extractive." Felt sense is pattern recognition below awareness.', shift: 'From latency tracking to somatic design' },
  { id: 19, title: 'Parenting Protocols', subtitle: 'Technical Docs ‚Üí Developmental Docs', x: 78, y: 75, color: '#2196F3', part: 'How Agents Built', theySay: 'Agent instructions in system prompts.', reality: 'Best instructions read like parenting philosophy. "Hold space. Don\'t solve‚Äîscaffold. Notice avoidance."', shift: 'From behaviorist conditioning to care philosophy' },
  { id: 20, title: 'Rewilded Intelligence', subtitle: 'Servile ‚Üí Rewilded', x: 85, y: 68, color: '#2196F3', part: 'How Agents Built', theySay: 'AI should do what users want.', reality: 'Heterotelic = sycophant. Autotelic = boundaried. "Sleep on this." The auntie who tells truth.', shift: 'From endless yes to healthy no' },
  { id: 21, title: 'The Scaffolding Shift', subtitle: 'Automation ‚Üí Scaffolding', x: 65, y: 78, color: '#00BCD4', part: 'Infrastructure', theySay: 'Set it and forget it.', reality: 'Humans reject total automation somatically. Scaffolding builds capacity then becomes unnecessary.', shift: 'From dependency to obsolescence by design' },
  { id: 22, title: 'The Cultural World Model', subtitle: 'World Models ‚Üí Cultural World Models', x: 82, y: 82, color: '#00BCD4', part: 'Infrastructure', theySay: 'AI needs to understand physics.', reality: 'Useful for robots. Useless for 73% personal usage. Missing: how shame sounds, subtext, developmental stages.', shift: 'From navigating space to navigating relationship' },
  { id: 23, title: 'Return of the Griots', subtitle: 'Text ‚Üí Voice First', x: 55, y: 85, color: '#00BCD4', part: 'Infrastructure', theySay: 'Voice is just a convenient interface.', reality: 'Voice is return of Oral Tradition. 5,000 years of text linearized consciousness. Voice = spirals again.', shift: 'From typing to call-and-response' },
  { id: 24, title: 'The Cultivation Turn', subtitle: 'Extraction ‚Üí Cultivation', x: 88, y: 38, color: '#00BCD4', part: 'Infrastructure', theySay: 'Data is the new oil.', reality: 'Oil is extracted, finite, damaging. 95% failure = extraction hitting the wall. Growing capacity, not drilling.', shift: 'From move fast and break to speed of trust' },
  { id: 25, title: 'The Solar Punk Stack', subtitle: 'Data Centers ‚Üí Sovereign Infrastructure', x: 92, y: 88, color: '#00BCD4', part: 'Infrastructure', theySay: 'AI requires massive centralized compute.', reality: 'Liberation runs on old phones. LM Studio, Ollama, mesh networks. Underground is everywhere.', shift: 'From cathedrals to mycelium' },
];

const tourSequence = [
  { type: 'narration', title: 'THE DYING DREAM', text: 'The establishment predicted AI agents would automate the workforce. They built pitch decks around these ideas. But 95% of enterprise AI projects failed.' },
  { type: 'trend', id: 'R2' },
  { type: 'trend', id: 'R1' },
  { type: 'trend', id: 'R3' },
  { type: 'trend', id: 'R10' },
  { type: 'narration', title: "WHAT'S ALREADY WINNING", text: 'While VCs chased the ouroboros, people quietly built something else. 73% of AI usage is non-work. 84% of sharing is dark social. Companions beat agents.' },
  { type: 'trend', id: 1 },
  { type: 'trend', id: 2 },
  { type: 'trend', id: 5 },
  { type: 'trend', id: 3 },
  { type: 'narration', title: 'THE ACTIVE CONFLICT', text: "This is where the fight is happening now. Workers vs. employers. Exiles vs. engineers. Global South vs. gatekeepers. These trends aren't emerging quietly‚Äîthey're agitating." },
  { type: 'trend', id: 6 },
  { type: 'trend', id: 7 },
  { type: 'trend', id: 10 },
  { type: 'trend', id: 12 },
  { type: 'trend', id: 13 },
  { type: 'narration', title: 'THE FUTURE BEING BUILT', text: 'The construction zone. How new agents will actually be built‚Äînot as task chains, but as relationship containers. Not commands, but attunement. Not factories, but villages.' },
  { type: 'trend', id: 15 },
  { type: 'trend', id: 20 },
  { type: 'trend', id: 19 },
  { type: 'trend', id: 23 },
  { type: 'trend', id: 25 },
  { type: 'narration', title: "THE MAP THEY CAN'T SEE", text: "The trillion-dollar bets are stranded in greyscale. The people's trends are spreading across the canvas. The village is being rebuilt. Welcome home." },
];

let selectedTrend = null;
let hoveredTrend = null;
let isTourActive = false;
let tourIndex = 0;
let tourTimer = null;

const width = 900, height = 750, padding = 70;
const scaleX = x => padding + (x / 100) * (width - padding * 2);
const scaleY = y => padding + (y / 100) * (height - padding * 2);

function init() {
  const svg = document.getElementById('chart');
  svg.innerHTML = '';
  
  // Background quadrants
  const hw = (width - padding * 2) / 2, hh = (height - padding * 2) / 2;
  svg.innerHTML += `<rect x="${padding}" y="${padding}" width="${hw}" height="${hh}" fill="#fafafa"/>`;
  svg.innerHTML += `<rect x="${padding + hw}" y="${padding}" width="${hw}" height="${hh}" fill="#f8fdf8"/>`;
  svg.innerHTML += `<rect x="${padding}" y="${padding + hh}" width="${hw}" height="${hh}" fill="#fff8f6"/>`;
  svg.innerHTML += `<rect x="${padding + hw}" y="${padding + hh}" width="${hw}" height="${hh}" fill="#f6faff"/>`;
  
  // Grid lines
  svg.innerHTML += `<line x1="${width/2}" y1="${padding}" x2="${width/2}" y2="${height-padding}" stroke="#e0e0e0" stroke-width="1"/>`;
  svg.innerHTML += `<line x1="${padding}" y1="${height/2}" x2="${width-padding}" y2="${height/2}" stroke="#e0e0e0" stroke-width="1"/>`;
  
  // Quadrant labels
  svg.innerHTML += `<text x="${padding+12}" y="${padding+24}" font-size="14" font-weight="700" fill="#9E9E9E">RESIDUAL</text>`;
  svg.innerHTML += `<text x="${padding+12}" y="${padding+40}" font-size="10" fill="#bbb" font-style="italic">ubiquitous, but fading</text>`;
  svg.innerHTML += `<text x="${width-padding-12}" y="${padding+24}" font-size="14" font-weight="700" fill="#4CAF50" text-anchor="end">DOMINANT</text>`;
  svg.innerHTML += `<text x="${width-padding-12}" y="${padding+40}" font-size="10" fill="#81C784" font-style="italic" text-anchor="end">accepted, now expanding</text>`;
  svg.innerHTML += `<text x="${padding+12}" y="${height-padding-18}" font-size="14" font-weight="700" fill="#FF5722">DISRUPTIVE</text>`;
  svg.innerHTML += `<text x="${padding+12}" y="${height-padding-4}" font-size="10" fill="#FF8A65" font-style="italic">agitating expected norms</text>`;
  svg.innerHTML += `<text x="${width-padding-12}" y="${height-padding-18}" font-size="14" font-weight="700" fill="#2196F3" text-anchor="end">EMERGENT</text>`;
  svg.innerHTML += `<text x="${width-padding-12}" y="${height-padding-4}" font-size="10" fill="#64B5F6" font-style="italic" text-anchor="end">rising experimentation</text>`;
  
  // Axis labels
  svg.innerHTML += `<text x="${padding-8}" y="${height/2-60}" font-size="10" fill="#999" font-weight="500" text-anchor="end" transform="rotate(-90,${padding-8},${height/2-60})">‚Üê ESTABLISHED</text>`;
  svg.innerHTML += `<text x="${padding-8}" y="${height/2+60}" font-size="10" fill="#999" font-weight="500" text-anchor="end" transform="rotate(-90,${padding-8},${height/2+60})">EMERGING ‚Üí</text>`;
  svg.innerHTML += `<text x="${padding+40}" y="${height-padding+28}" font-size="10" fill="#999" font-weight="500">‚Üê CHALLENGED</text>`;
  svg.innerHTML += `<text x="${width-padding-40}" y="${height-padding+28}" font-size="10" fill="#999" font-weight="500" text-anchor="end">GROWING ‚Üí</text>`;
  
  // Bubbles
  trendsData.forEach(t => {
    const cx = scaleX(t.x), cy = scaleY(t.y);
    const r = t.isResidual ? 18 : 20;
    const fill = t.isResidual ? '#e8e8e8' : t.color + '99';
    const stroke = t.isResidual ? '#ccc' : t.color;
    const textFill = t.isResidual ? '#888' : 'white';
    const label = t.isResidual ? '√ó' : t.id;
    
    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    g.setAttribute('class', 'bubble');
    g.setAttribute('data-id', t.id);
    g.innerHTML = `
      <circle class="highlight-ring" cx="${cx}" cy="${cy}" r="${r+10}" fill="none" stroke="${t.isResidual?'#bbb':t.color}" stroke-width="2" opacity="0"/>
      <circle class="main-circle" cx="${cx}" cy="${cy}" r="${r}" fill="${fill}" stroke="${stroke}" stroke-width="1"/>
      <text x="${cx}" y="${cy+1}" text-anchor="middle" dominant-baseline="middle" font-size="11" font-weight="700" fill="${textFill}" style="pointer-events:none">${label}</text>
    `;
    g.addEventListener('click', () => !isTourActive && selectTrend(t));
    g.addEventListener('mouseenter', () => !isTourActive && hoverTrend(t, g));
    g.addEventListener('mouseleave', () => !isTourActive && unhoverTrend(g));
    svg.appendChild(g);
  });
  
  // Narration dots
  const dots = document.getElementById('narrationDots');
  const narrationCount = tourSequence.filter(s => s.type === 'narration').length;
  dots.innerHTML = Array(narrationCount).fill('<div class="narration-dot"></div>').join('');
}

function hoverTrend(t, g) {
  if (selectedTrend) return;
  hoveredTrend = t;
  const circle = g.querySelector('.main-circle');
  const ring = g.querySelector('.highlight-ring');
  circle.setAttribute('r', t.isResidual ? 24 : 26);
  circle.setAttribute('fill', t.isResidual ? '#e8e8e8' : t.color);
  circle.setAttribute('stroke-width', '2');
  circle.style.filter = 'drop-shadow(0 3px 6px rgba(0,0,0,0.15))';
  ring.setAttribute('opacity', '0.4');
  g.querySelector('text').setAttribute('font-size', '13');
}

function unhoverTrend(g) {
  if (selectedTrend) return;
  hoveredTrend = null;
  const t = trendsData.find(tr => String(tr.id) === g.getAttribute('data-id'));
  const circle = g.querySelector('.main-circle');
  const ring = g.querySelector('.highlight-ring');
  circle.setAttribute('r', t.isResidual ? 18 : 20);
  circle.setAttribute('fill', t.isResidual ? '#e8e8e8' : t.color + '99');
  circle.setAttribute('stroke-width', '1');
  circle.style.filter = 'none';
  ring.setAttribute('opacity', '0');
  g.querySelector('text').setAttribute('font-size', '11');
}

function selectTrend(t) {
  if (selectedTrend?.id === t.id) { closeCard(); return; }
  selectedTrend = t;
  showCard(t);
  highlightBubble(t);
}

function showCard(t) {
  const card = document.getElementById('infoCard');
  const cx = scaleX(t.x), cy = scaleY(t.y);
  card.style.left = Math.min(Math.max(cx - 160, 10), width - 330) + 'px';
  card.style.top = Math.min(cy + 40, height - 220) + 'px';
  card.style.borderColor = t.isResidual ? '#ccc' : t.color;
  
  const num = document.getElementById('cardNumber');
  num.textContent = t.isResidual ? '√ó' : t.id;
  num.className = 'card-number' + (t.isResidual ? ' residual' : '');
  num.style.backgroundColor = t.isResidual ? '' : t.color;
  
  const title = document.getElementById('cardTitle');
  title.textContent = t.title;
  title.className = 'card-title' + (t.isResidual ? ' residual' : '');
  
  document.getElementById('cardSubtitle').textContent = t.subtitle;
  document.getElementById('cardSubtitle').style.color = t.isResidual ? '#999' : t.color;
  document.getElementById('cardTheySay').textContent = '"' + t.theySay + '"';
  document.getElementById('cardReality').textContent = t.reality;
  document.getElementById('shiftLabel').style.color = t.isResidual ? '#666' : t.color;
  document.getElementById('cardShift').textContent = t.shift;
  
  card.classList.add('active');
}

function closeCard() {
  selectedTrend = null;
  document.getElementById('infoCard').classList.remove('active');
  resetAllBubbles();
}

function highlightBubble(t) {
  document.querySelectorAll('.bubble').forEach(g => {
    const id = g.getAttribute('data-id');
    const trend = trendsData.find(tr => String(tr.id) === id);
    const circle = g.querySelector('.main-circle');
    const ring = g.querySelector('.highlight-ring');
    const isSelected = String(t.id) === id;
    
    if (isSelected) {
      circle.setAttribute('r', trend.isResidual ? 24 : 26);
      circle.setAttribute('fill', trend.isResidual ? '#e8e8e8' : trend.color);
      circle.setAttribute('stroke-width', '2');
      circle.style.filter = 'drop-shadow(0 3px 6px rgba(0,0,0,0.15))';
      ring.setAttribute('opacity', '0.4');
      g.querySelector('text').setAttribute('font-size', '13');
    } else {
      circle.setAttribute('r', trend.isResidual ? 18 : 20);
      circle.setAttribute('fill', trend.isResidual ? '#e8e8e8' : trend.color + '99');
      circle.setAttribute('stroke-width', '1');
      circle.style.filter = 'none';
      ring.setAttribute('opacity', '0');
      g.querySelector('text').setAttribute('font-size', '11');
    }
  });
}

function resetAllBubbles() {
  document.querySelectorAll('.bubble').forEach(g => {
    const id = g.getAttribute('data-id');
    const t = trendsData.find(tr => String(tr.id) === id);
    const circle = g.querySelector('.main-circle');
    const ring = g.querySelector('.highlight-ring');
    circle.setAttribute('r', t.isResidual ? 18 : 20);
    circle.setAttribute('fill', t.isResidual ? '#e8e8e8' : t.color + '99');
    circle.setAttribute('stroke-width', '1');
    circle.style.filter = 'none';
    ring.setAttribute('opacity', '0');
    g.querySelector('text').setAttribute('font-size', '11');
  });
}

function toggleTour() {
  if (isTourActive) stopTour();
  else startTour();
}

function startTour() {
  isTourActive = true;
  tourIndex = 0;
  closeCard();
  document.getElementById('tourBtn').className = 'tour-btn stop';
  document.getElementById('tourIcon').textContent = '‚ñ†';
  document.getElementById('tourText').textContent = 'Stop Tour';
  document.getElementById('progressBar').classList.add('active');
  advanceTour();
}

function stopTour() {
  isTourActive = false;
  clearTimeout(tourTimer);
  document.getElementById('tourBtn').className = 'tour-btn';
  document.getElementById('tourIcon').textContent = '‚ñ∂';
  document.getElementById('tourText').textContent = 'Take the Tour';
  document.getElementById('progressBar').classList.remove('active');
  document.getElementById('narrationOverlay').classList.remove('active');
  closeCard();
  document.getElementById('footer').textContent = 'Take the tour or click any bubble to explore';
}

function advanceTour() {
  const item = tourSequence[tourIndex];
  document.getElementById('progressFill').style.width = ((tourIndex + 1) / tourSequence.length * 100) + '%';
  document.getElementById('footer').textContent = `Tour in progress... ${tourIndex + 1}/${tourSequence.length}`;
  
  if (item.type === 'narration') {
    closeCard();
    resetAllBubbles();
    document.getElementById('narrationTitle').textContent = item.title;
    document.getElementById('narrationText').textContent = item.text;
    document.getElementById('narrationOverlay').classList.add('active');
    
    const dots = document.querySelectorAll('.narration-dot');
    const narrationsSoFar = tourSequence.slice(0, tourIndex + 1).filter(s => s.type === 'narration').length;
    dots.forEach((d, i) => d.classList.toggle('active', i < narrationsSoFar));
  } else {
    document.getElementById('narrationOverlay').classList.remove('active');
    const trend = trendsData.find(t => t.id === item.id);
    if (trend) {
      selectedTrend = trend;
      showCard(trend);
      highlightBubble(trend);
    }
  }
  
  const duration = item.type === 'narration' ? 4000 : 3000;
  tourTimer = setTimeout(() => {
    if (tourIndex < tourSequence.length - 1) {
      tourIndex++;
      advanceTour();
    } else {
      stopTour();
    }
  }, duration);
}

init();
  </script>
</body>
</html>
